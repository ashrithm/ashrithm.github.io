---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Card from "@/components/Card.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import { SITE } from "@/config";
import { slugifyStr } from "@/utils/slugify";

const posts = await getCollection("blog");

const sortedPosts = getSortedPosts(posts);

const featuredProjects = [
  {
    title: "ashrithm.com",
    url: "https://github.com/ashrithm/ashrithm",
    description:
      "This website — a minimal, typography-driven personal site built with Astro, Tailwind CSS, and self-hosted iA Writer Quattro.",
    tags: ["Astro", "Tailwind CSS", "TypeScript"],
  },
];
---

<Layout>
  <Header />
  <main id="main-content" data-layout="index" class="app-layout">
    <section id="hero" class="pt-10 pb-8 sm:pt-14 sm:pb-10 border-b border-border">
      <div class="flex flex-col items-start gap-8 sm:flex-row sm:items-center">
        <img
          src="/assets/a person/bust.svg"
          alt="Ashrith"
          class="w-24 h-auto shrink-0 sm:w-44 lg:w-52"
        />
        <div class="flex items-stretch gap-3 sm:gap-5">
          <!-- Opening brace -->
          <span class="font-code text-6xl leading-none text-muted/30 select-none flex items-center sm:text-7xl lg:text-8xl" aria-hidden="true">&#123;</span>
          <div class="py-2">
            <h1 class="text-4xl font-bold sm:text-5xl">
              hey there!
            </h1>
            <p class="mt-4 text-lg leading-relaxed sm:text-xl">
              I'm Ashrith — aerospace engineer, technology enthusiast, and explorer of
              data science and artificial intelligence. Read more about me
              <a
                class="decoration-dashed underline-offset-4 hover:underline"
                href="/about/"
              >here</a>.
            </p>
            <div class="mt-5 flex items-center gap-4 text-base">
              <a href="https://github.com/ashrithm" target="_blank" rel="noopener noreferrer" class="decoration-dashed underline-offset-4 hover:underline hover:text-muted">GitHub</a>
              <span class="text-muted">/</span>
              <a href="https://linkedin.com/in/ashrithm" target="_blank" rel="noopener noreferrer" class="decoration-dashed underline-offset-4 hover:underline hover:text-muted">LinkedIn</a>
              <span class="text-muted">/</span>
              <a href="mailto:me@ashrithm.com" class="decoration-dashed underline-offset-4 hover:underline hover:text-muted">Email</a>
              <span class="text-muted">/</span>
              <a href="/rss.xml" target="_blank" class="decoration-dashed underline-offset-4 hover:underline hover:text-muted">RSS</a>
            </div>
          </div>
          <!-- Closing brace -->
          <span class="font-code text-6xl leading-none text-muted/30 select-none flex items-center sm:text-7xl lg:text-8xl" aria-hidden="true">&#125;</span>
        </div>
      </div>
    </section>

    {
      sortedPosts.length > 0 && (
        <section id="posts" class="pt-14 pb-8">
          <h2 class="text-2xl font-semibold">Posts</h2>
          <ul>
            {sortedPosts.map(
              (data, index) =>
                index < SITE.postPerIndex && <Card variant="h3" {...data} />
            )}
          </ul>
        </section>
      )
    }

    <div class="mt-4 mb-10">
      <a href="/posts/" class="text-base decoration-dashed underline-offset-4 hover:underline hover:text-muted">
        All posts &rarr;
      </a>
    </div>

    <section id="projects" class="pt-8 pb-8 border-t border-border">
      <h2 class="text-2xl font-semibold">Projects</h2>
      <ul class="mt-4">
        {
          featuredProjects.map(project => (
            <li class="my-5 border-b border-border pb-5 last:border-0">
              <a
                href={project.url}
                class="text-lg font-medium decoration-dashed underline-offset-4 hover:underline hover:text-muted"
                target="_blank"
                rel="noopener noreferrer"
              >
                {project.title}
              </a>
              <div class="mt-1.5 flex flex-wrap gap-1.5">
                {project.tags.map(tag => (
                  <a
                    href={`/tags/${slugifyStr(tag)}`}
                    class="rounded bg-muted/20 px-2 py-0.5 text-sm text-muted hover:text-foreground"
                  >
                    {tag}
                  </a>
                ))}
              </div>
              <p class="mt-1.5 text-sm text-muted">{project.description}</p>
            </li>
          ))
        }
      </ul>
      <div class="mt-4">
        <a href="/projects/" class="text-base decoration-dashed underline-offset-4 hover:underline hover:text-muted">
          All projects &rarr;
        </a>
      </div>
    </section>
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>
